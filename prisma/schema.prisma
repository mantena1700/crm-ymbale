generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// CONFIGURAÇÕES DO SISTEMA (WHITE LABEL)
// ========================================

model SystemSettings {
  id            String   @id @default("system")
  crmName       String   @default("Ymbale") @map("crm_name") @db.VarChar(100)
  crmLogo       String?  @map("crm_logo") @db.VarChar(500)
  crmFavicon    String?  @map("crm_favicon") @db.VarChar(500)
  primaryColor  String   @default("#6366f1") @map("primary_color") @db.VarChar(7)
  secondaryColor String  @default("#8b5cf6") @map("secondary_color") @db.VarChar(7)
  accentColor   String   @default("#10b981") @map("accent_color") @db.VarChar(7)
  companyName   String?  @map("company_name") @db.VarChar(255)
  companyEmail  String?  @map("company_email") @db.VarChar(255)
  companyPhone  String?  @map("company_phone") @db.VarChar(50)
  
  // Personalização da Página de Login
  loginTitle        String?  @map("login_title") @db.VarChar(100)
  loginSubtitle     String?  @map("login_subtitle") @db.VarChar(255)
  loginMessage      String?  @map("login_message") @db.Text
  loginShowMessage  Boolean  @default(false) @map("login_show_message")
  loginBackgroundColor String? @map("login_background_color") @db.VarChar(7)
  loginLogo         String?  @map("login_logo") @db.VarChar(500)
  
  // API Keys (armazenadas criptografadas)
  openaiApiKey      String?  @map("openai_api_key") @db.VarChar(500)
  googleMapsApiKey  String?  @map("google_maps_api_key") @db.VarChar(500)
  googleAiApiKey    String?  @map("google_ai_api_key") @db.VarChar(500)
  
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  updatedBy     String?  @map("updated_by") @db.Uuid

  @@map("system_settings")
}

// ========================================
// AGENTES DE IA
// ========================================

model AIAgent {
  id                 String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  code               String   @unique @db.VarChar(50)  // "restaurant_analyzer", "email_generator", etc
  name               String   @db.VarChar(100)
  description        String?  @db.Text
  systemPrompt       String   @map("system_prompt") @db.Text
  userPromptTemplate String   @map("user_prompt_template") @db.Text
  model              String   @default("gpt-4o-mini") @db.VarChar(50)
  temperature        Decimal  @default(0.7) @db.Decimal(2, 1)
  maxTokens          Int      @default(1000) @map("max_tokens")
  active             Boolean  @default(true)
  isDefault          Boolean  @default(true) @map("is_default")  // Se é o prompt padrão do sistema
  createdAt          DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([code], map: "idx_ai_agents_code")
  @@index([active], map: "idx_ai_agents_active")
  @@map("ai_agents")
}

// ========================================
// SISTEMA DE AUTENTICAÇÃO
// ========================================

model User {
  id                 String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  username           String    @unique @db.VarChar(50)
  email              String?   @unique @db.VarChar(255)
  password           String    @db.VarChar(255) // Hash bcrypt
  name               String    @db.VarChar(255)
  role               String    @default("user") @db.VarChar(20) // 'admin' ou 'user'
  active             Boolean   @default(true)
  mustChangePassword Boolean   @default(false) @map("must_change_password")
  lastLogin          DateTime? @map("last_login") @db.Timestamptz(6)
  loginAttempts      Int       @default(0) @map("login_attempts")
  lockedUntil        DateTime? @map("locked_until") @db.Timestamptz(6)
  createdAt          DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  createdBy          String?   @map("created_by") @db.Uuid

  // Relação com o vendedor
  sellerId      String?   @unique @map("seller_id") @db.Uuid
  seller        Seller?   @relation(fields: [sellerId], references: [id], onDelete: SetNull)

  // Sessões e permissões
  sessions         Session[]
  userPermissions  UserPermission[]

  @@index([username], map: "idx_users_username")
  @@index([email], map: "idx_users_email")
  @@index([role], map: "idx_users_role")
  @@index([active], map: "idx_users_active")
  @@map("users")
}

// ========================================
// SISTEMA DE PERMISSÕES
// ========================================

model Permission {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  code        String   @unique @db.VarChar(50)  // ex: "dashboard.view", "clients.create"
  name        String   @db.VarChar(100)
  description String?  @db.VarChar(255)
  module      String   @db.VarChar(50)  // ex: "dashboard", "clients", "pipeline"
  action      String   @db.VarChar(20)  // "view", "create", "edit", "delete"
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  
  userPermissions UserPermission[]

  @@index([module], map: "idx_permissions_module")
  @@index([code], map: "idx_permissions_code")
  @@map("permissions")
}

model UserPermission {
  userId       String @map("user_id") @db.Uuid
  permissionId String @map("permission_id") @db.Uuid
  grantedAt    DateTime @default(now()) @map("granted_at") @db.Timestamptz(6)
  grantedBy    String?  @map("granted_by") @db.Uuid
  
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@id([userId, permissionId])
  @@index([userId], map: "idx_user_permissions_user_id")
  @@index([permissionId], map: "idx_user_permissions_permission_id")
  @@map("user_permissions")
}

model Session {
  id           String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId       String   @map("user_id") @db.Uuid
  token        String   @unique @db.VarChar(500)
  expiresAt    DateTime @map("expires_at") @db.Timestamptz(6)
  ipAddress    String?  @map("ip_address") @db.VarChar(50)
  userAgent    String?  @map("user_agent") @db.VarChar(500)
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token], map: "idx_sessions_token")
  @@index([userId], map: "idx_sessions_user_id")
  @@index([expiresAt], map: "idx_sessions_expires_at")
  @@map("sessions")
}

// ========================================
// MODELOS EXISTENTES
// ========================================

model Seller {
  user          User?
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name          String    @db.VarChar(255)
  email         String?   @db.VarChar(255)
  phone         String?   @db.VarChar(50)
  photoUrl      String?   @map("photo_url") @db.VarChar(500)
  regions       Json?     @default("[]")
  neighborhoods Json?     @default("[]")
  active        Boolean?  @default(true)
  createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  restaurants Restaurant[]
  visits      Visit[]
  zonas       SellerZona[]

  @@map("sellers")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model Restaurant {
  id                  String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                String    @db.VarChar(255)
  rating              Decimal?  @default(0) @db.Decimal(3, 2)
  reviewCount         Int?      @default(0) @map("review_count")
  totalComments       Int?      @default(0) @map("total_comments")
  projectedDeliveries Int?      @default(0) @map("projected_deliveries")
  salesPotential      String?   @default("N/A") @map("sales_potential") @db.VarChar(50)
  address             Json?     @default("{}")
  lastCollectionDate  DateTime? @map("last_collection_date") @db.Date
  status              String?   @default("A Analisar") @db.VarChar(50)
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  sourceFile          String?   @map("source_file") @db.VarChar(255)
  sellerId            String?   @map("seller_id") @db.Uuid
  assignedAt          DateTime? @map("assigned_at") @db.Timestamptz(6)
  zonaId              String?   @map("zona_id") @db.Uuid

  seller    Seller?   @relation(fields: [sellerId], references: [id], onDelete: SetNull)
  zona      ZonaCep?  @relation(fields: [zonaId], references: [id], onDelete: SetNull)
  visits    Visit[]
  comments  Comment[]
  analyses  Analysis[]
  notes     Note[]
  followUps FollowUp[]
  activityLog ActivityLog[]
  campaignRecipients CampaignRecipient[]
  workflowExecutions WorkflowExecution[]

  @@index([createdAt(sort: Desc)], map: "idx_restaurants_created_at")
  @@index([rating(sort: Desc)], map: "idx_restaurants_rating")
  @@index([salesPotential], map: "idx_restaurants_sales_potential")
  @@index([sellerId], map: "idx_restaurants_seller_id")
  @@index([status], map: "idx_restaurants_status")
  @@index([zonaId], map: "idx_restaurants_zona_id")
  @@map("restaurants")
}

model Comment {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  restaurantId String    @map("restaurant_id") @db.Uuid
  content      String
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)

  restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([createdAt(sort: Desc)], map: "idx_comments_created_at")
  @@index([restaurantId], map: "idx_comments_restaurant_id")
  @@map("comments")
}

model Analysis {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  restaurantId String    @map("restaurant_id") @db.Uuid
  score        Int
  summary      String
  painPoints   Json?     @default("[]") @map("pain_points")
  salesCopy    String?   @map("sales_copy")
  strategy     String?
  status       String?   @default("A Analisar") @db.VarChar(50)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@unique([restaurantId, createdAt])
  @@index([createdAt(sort: Desc)], map: "idx_analyses_created_at")
  @@index([restaurantId], map: "idx_analyses_restaurant_id")
  @@index([score(sort: Desc)], map: "idx_analyses_score")
  @@map("analyses")
}

model Note {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  restaurantId String    @map("restaurant_id") @db.Uuid
  content      String
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)

  restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([createdAt(sort: Desc)], map: "idx_notes_created_at")
  @@index([restaurantId], map: "idx_notes_restaurant_id")
  @@map("notes")
}

model FollowUp {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  restaurantId  String    @map("restaurant_id") @db.Uuid
  type          String    @db.VarChar(20)
  scheduledDate DateTime  @map("scheduled_date") @db.Timestamptz(6)
  completed     Boolean?  @default(false)
  completedDate DateTime? @map("completed_date") @db.Timestamptz(6)
  notes         String?
  emailSubject  String?   @map("email_subject") @db.VarChar(255)
  emailBody     String?   @map("email_body")
  emailSent     Boolean?  @default(false) @map("email_sent")
  createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  visits     Visit[]

  @@index([completed], map: "idx_follow_ups_completed")
  @@index([restaurantId], map: "idx_follow_ups_restaurant_id")
  @@index([scheduledDate], map: "idx_follow_ups_scheduled_date")
  @@map("follow_ups")
}

model Goal {
  id        String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name      String    @db.VarChar(255)
  type      String    @db.VarChar(50)
  target    Decimal   @db.Decimal(15, 2)
  current   Decimal?  @default(0) @db.Decimal(15, 2)
  period    String    @db.VarChar(20)
  startDate DateTime  @map("start_date") @db.Date
  endDate   DateTime  @map("end_date") @db.Date
  status    String?   @default("active") @db.VarChar(20)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([startDate, endDate], map: "idx_goals_dates")
  @@index([period], map: "idx_goals_period")
  @@index([status], map: "idx_goals_status")
  @@map("goals")
}

model AutomationRule {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name              String    @db.VarChar(255)
  conditionField    String    @map("condition_field") @db.VarChar(50)
  conditionOperator String    @map("condition_operator") @db.VarChar(10)
  conditionValue    String    @map("condition_value")
  actionType        String    @map("action_type") @db.VarChar(50)
  actionValue       String    @map("action_value")
  enabled           Boolean?  @default(true)
  createdAt         DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@map("automation_rules")
}

model Notification {
  id        String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  type      String    @db.VarChar(50)
  title     String    @db.VarChar(255)
  message   String
  read      Boolean?  @default(false)
  metadata  Json?     @default("{}")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([createdAt(sort: Desc)], map: "idx_notifications_created_at")
  @@index([read], map: "idx_notifications_read")
  @@map("notifications")
}

model ActivityLog {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  type         String    @db.VarChar(50)
  title        String    @db.VarChar(255)
  description  String?
  restaurantId String?   @map("restaurant_id") @db.Uuid
  metadata     Json?     @default("{}")
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)

  restaurant Restaurant? @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([createdAt(sort: Desc)], map: "idx_activity_log_created_at")
  @@index([restaurantId], map: "idx_activity_log_restaurant_id")
  @@index([type], map: "idx_activity_log_type")
  @@map("activity_log")
}

model Visit {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  restaurantId String    @map("restaurant_id") @db.Uuid
  sellerId     String    @map("seller_id") @db.Uuid
  visitDate    DateTime  @map("visit_date") @db.Timestamptz(6)
  feedback     String?   @db.Text
  outcome      String?   @db.VarChar(50) // 'positive', 'neutral', 'negative', 'scheduled'
  nextVisitDate DateTime? @map("next_visit_date") @db.Timestamptz(6)
  followUpId   String?   @map("follow_up_id") @db.Uuid
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  seller     Seller     @relation(fields: [sellerId], references: [id], onDelete: Cascade)
  followUp   FollowUp?  @relation(fields: [followUpId], references: [id], onDelete: SetNull)

  @@index([restaurantId], map: "idx_visits_restaurant_id")
  @@index([sellerId], map: "idx_visits_seller_id")
  @@index([visitDate(sort: Desc)], map: "idx_visits_visit_date")
  @@index([outcome], map: "idx_visits_outcome")
  @@map("visits")
}

// ========================================
// CAMPANHAS E MARKETING
// ========================================

model Campaign {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name              String    @db.VarChar(255)
  description       String?   @db.Text
  type              String    @default("email") @db.VarChar(50) // 'email', 'whatsapp', 'sms', 'linkedin'
  status            String    @default("draft") @db.VarChar(20) // 'draft', 'scheduled', 'active', 'paused', 'completed', 'cancelled'
  
  // Segmentação
  segmentCriteria   Json?     @default("{}") @map("segment_criteria")
  
  // Conteúdo
  subject           String?   @db.VarChar(255)
  content           String?   @db.Text
  templateId        String?   @map("template_id") @db.Uuid
  
  // Agendamento
  scheduledAt       DateTime? @map("scheduled_at") @db.Timestamptz(6)
  startedAt         DateTime? @map("started_at") @db.Timestamptz(6)
  endedAt           DateTime? @map("ended_at") @db.Timestamptz(6)
  
  // Métricas
  totalRecipients   Int       @default(0) @map("total_recipients")
  sentCount         Int       @default(0) @map("sent_count")
  deliveredCount    Int       @default(0) @map("delivered_count")
  openedCount       Int       @default(0) @map("opened_count")
  clickedCount      Int       @default(0) @map("clicked_count")
  convertedCount    Int       @default(0) @map("converted_count")
  
  // Automação
  autoFollowUp      Boolean   @default(false) @map("auto_follow_up")
  followUpDays      Int       @default(7) @map("follow_up_days")
  
  // Workflow
  workflowSteps     Json?     @default("[]") @map("workflow_steps")
  
  // IA
  aiGenerated       Boolean   @default(false) @map("ai_generated")
  aiPrompt          String?   @db.Text @map("ai_prompt")
  
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  createdBy         String?   @map("created_by") @db.Uuid

  recipients        CampaignRecipient[]
  template          EmailTemplate? @relation(fields: [templateId], references: [id], onDelete: SetNull)

  @@index([status], map: "idx_campaigns_status")
  @@index([type], map: "idx_campaigns_type")
  @@index([scheduledAt], map: "idx_campaigns_scheduled_at")
  @@index([createdAt(sort: Desc)], map: "idx_campaigns_created_at")
  @@map("campaigns")
}

model CampaignRecipient {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  campaignId    String    @map("campaign_id") @db.Uuid
  restaurantId  String    @map("restaurant_id") @db.Uuid
  
  status        String    @default("pending") @db.VarChar(20) // 'pending', 'sent', 'delivered', 'opened', 'clicked', 'converted', 'bounced', 'unsubscribed'
  
  sentAt        DateTime? @map("sent_at") @db.Timestamptz(6)
  deliveredAt   DateTime? @map("delivered_at") @db.Timestamptz(6)
  openedAt      DateTime? @map("opened_at") @db.Timestamptz(6)
  clickedAt     DateTime? @map("clicked_at") @db.Timestamptz(6)
  convertedAt   DateTime? @map("converted_at") @db.Timestamptz(6)
  
  metadata      Json?     @default("{}")
  
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  campaign      Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  restaurant    Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@unique([campaignId, restaurantId])
  @@index([campaignId], map: "idx_campaign_recipients_campaign_id")
  @@index([restaurantId], map: "idx_campaign_recipients_restaurant_id")
  @@index([status], map: "idx_campaign_recipients_status")
  @@map("campaign_recipients")
}

model EmailTemplate {
  id          String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String    @db.VarChar(255)
  subject     String?   @db.VarChar(255)
  content     String    @db.Text
  variables   Json?     @default("[]")
  category    String?   @db.VarChar(50) // 'prospecting', 'follow_up', 're_engagement', 'custom'
  
  isDefault   Boolean   @default(false) @map("is_default")
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  createdBy   String?   @map("created_by") @db.Uuid

  campaigns   Campaign[]

  @@index([category], map: "idx_email_templates_category")
  @@index([isDefault], map: "idx_email_templates_is_default")
  @@map("email_templates")
}

model Workflow {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name              String    @db.VarChar(255)
  description       String?   @db.Text
  triggerType       String    @map("trigger_type") @db.VarChar(50) // 'status_change', 'new_lead', 'no_contact_days', 'rating_threshold', 'manual'
  triggerConditions Json?     @default("{}") @map("trigger_conditions")
  
  steps             Json      @default("[]")
  
  active            Boolean   @default(true)
  executionCount    Int       @default(0) @map("execution_count")
  lastExecutedAt    DateTime? @map("last_executed_at") @db.Timestamptz(6)
  
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  createdBy         String?   @map("created_by") @db.Uuid

  executions        WorkflowExecution[]

  @@index([triggerType], map: "idx_workflows_trigger_type")
  @@index([active], map: "idx_workflows_active")
  @@map("workflows")
}

model WorkflowExecution {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  workflowId    String    @map("workflow_id") @db.Uuid
  restaurantId  String    @map("restaurant_id") @db.Uuid
  
  status        String    @default("running") @db.VarChar(20) // 'running', 'completed', 'failed', 'paused'
  currentStep   Int       @default(0) @map("current_step")
  stepsCompleted Json?    @default("[]") @map("steps_completed")
  
  startedAt     DateTime  @default(now()) @map("started_at") @db.Timestamptz(6)
  completedAt   DateTime? @map("completed_at") @db.Timestamptz(6)
  errorMessage  String?   @db.Text @map("error_message")
  
  metadata      Json?     @default("{}")

  workflow      Workflow   @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  restaurant    Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([workflowId], map: "idx_workflow_executions_workflow_id")
  @@index([restaurantId], map: "idx_workflow_executions_restaurant_id")
  @@index([status], map: "idx_workflow_executions_status")
  @@map("workflow_executions")
}

// ========================================
// ZONAS DE ATENDIMENTO POR CEP
// ========================================

model ZonaCep {
  id          String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  zonaNome    String    @map("zona_nome") @db.VarChar(100)
  cepInicial  String    @map("cep_inicial") @db.VarChar(9)
  cepFinal    String    @map("cep_final") @db.VarChar(9)
  ativo       Boolean   @default(true)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  sellers    SellerZona[]
  restaurants Restaurant[]

  @@index([ativo], map: "idx_zonas_cep_ativo")
  @@index([cepInicial, cepFinal], map: "idx_zonas_cep_range")
  @@map("zonas_cep")
}

model SellerZona {
  id          String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sellerId    String    @map("seller_id") @db.Uuid
  zonaId      String    @map("zona_id") @db.Uuid
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  seller     Seller    @relation(fields: [sellerId], references: [id], onDelete: Cascade)
  zona       ZonaCep   @relation(fields: [zonaId], references: [id], onDelete: Cascade)

  @@unique([sellerId, zonaId])
  @@index([sellerId], map: "idx_seller_zonas_seller_id")
  @@index([zonaId], map: "idx_seller_zonas_zona_id")
  @@map("seller_zonas")
}
